<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…ÙˆÙ† Ù…Ø³Ù†Ø¬Ø± (Ø¢Ù†Ù„Ø§ÛŒÙ†)</title>
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.0.0/dist/font-face.css" rel="stylesheet">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Vazir',sans-serif; }
    body {
      background: linear-gradient(135deg, #24243e, #302b63);
      min-height:100vh;
      color:white;
      overflow:hidden;
      position:relative    }
    .bg {
      position:absolute; top:0; left:0; width:100%; height:100%;
      background:radial-gradient(circle at 10% 20%, rgba(106,17,203,0.2), transparent 20%),
                  radial-gradient(circle at 90% 80%, rgba(37,117,252,0.2), transparent 20%);
    }
    .container {
      max-width:500px; margin:0 auto; padding:2rem; position:relative; z-index:2;
      display:flex; flex-direction:column; gap:1.5rem;
    }
    .card {
      background:rgba(255,255,255,0.08);
      backdrop-filter:blur(12px);
      border-radius:20px;
      padding:2rem;
      box-shadow:0 8px 32px rgba(0,0,0,0.2);
      border:1px solid rgba(255,255,255,0.1);
    }
    h1,h2 { text-align:center; margin-bottom:1.5rem; font-weight:800; }
    input,button {
100%; padding:1rem; border-radius:14px; border:none;
      background:rgba(255,255,255,0.12); color:white; font-size:1rem;
      margin-bottom:1rem;
    }
    button {
      background:linear-gradient(135deg,#6a11cb,#2575fc);
      color:white; font-weight:bold; cursor:pointer;
    }
    #chatBox { display:none; flex-direction:column; height:70vh; }
    #messages {
      flex:1; overflow-y:auto; padding:1rem; display:flex; flex-direction:column; gap:1rem;
    }
    .msg {
      background:rgba(255,255,255,0.1);
      padding:0.8rem 1rem; border-radius:12px; max-width:80%;
      word-wrap:break-word;
    }
    .hidden { display:none !important; }
    .error { color:#ff6b6b; text-align:center; font-size:0.9rem; }
  </style>
</head>
<body>
<div class="bg"></div>
<div class="container">
  <div id="welcome" class="card">
    <h1>Ù…ÙˆÙ† Ù…Ø³Ù†Ø¬Ø±</h1>
    <p style="text-align:center;color:rgba(255,255,255,0.7)">Ú†Øª Ø®ØµÙˆØµÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ùˆ Ù†ÙØ±</p>
    <button id="start">Ø´Ø±ÙˆØ¹</button>
  </div>

  <div id="login" class="card hidden">
    <h2>Ù†Ø§Ù… Ø´Ù…Ø§</h2>
    <input id="name" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ">
    <button id="join">ÙˆØ±ÙˆØ¯</button>
  </div>

  <div id="chat" class="card hidden">
    <div id="messages"></div>
    <input id="input" placeholder="Ù¾ÛŒØ§Ù…...">
  </div>
</div>

<script>
  const welcome = document.getElementById('welcome');
  const login = document.getElementById('login');
  const chat = document.getElementById('chat');
  const startBtn = document.getElementById('start');
  const joinBtn = document.getElementById('join');
  const nameInput = document.getElementById('name');
  const msgInput = document.getElementById('input');
  const messages = document.getElementById('messages');

  let userName = '';

  startBtn.onclick = () => {
    welcome.classList.add('hidden');
    login.classList.remove('hidden');
  };

  joinBtn.onclick = () => {
    const n = nameInput.value.trim();
    if (!n) return alert('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
    userName = n;
    login.classList.add('hidden');
    chat.classList.remove('hidden');

    // Load messages from URL hash
    const hash = window.location.hash.slice(1);
    if (hash) {
      try {
        const saved = JSON.parse(decodeURIComponent(hash));
        saved.forEach(m => addMsg(m.sender, m.text));
      } catch (e) {}
    }

    addMsg('system', `ğŸ‘‹ ${userName} ÙˆØ§Ø±Ø¯ Ø´Ø¯`);
  };

  msgInput.onkeypress = (e) => {
    if (e.key === 'Enter' && msgInput.value.trim()) {
      const text = msgInput.value.trim();
      addMsg(userName, text);
      msgInput.value = '';

      // Update URL hash
      const all = [];
      messages.querySelectorAll('.msg').forEach(el => {
        const sender = el.dataset.sender || 'system';
        const text = el.innerText.replace(`${sender}: `, '');
        all.push({ sender, text });
      });
      window.location.hash = encodeURIComponent(JSON.stringify(all));
    }
  };

  function addMsg(sender, text) {
    const div = document.createElement('div');
    div.className = 'msg';
    div.dataset.sender = sender;
    div.textContent = `${sender}: ${text}`;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  }
</script>
</body>
</html>
